<!-- 
Copyright 2019 The Cloud-Barista Authors.
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
    http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

----
Copyright for OpenLayers (https://openlayers.org/)

BSD 2-Clause License

Copyright 2005-present, OpenLayers Contributors
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.

2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
---- 
-->

<!DOCTYPE html>
<html lang="en">


<head>
  <title>CB-MapUI: Map Dashboard for Cloud-Barista</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg">

  <!-- Note: Polyfill removed as modern browsers (Chrome 24+, Firefox 23+, Safari 6.1+, Edge 12+) 
       natively support requestAnimationFrame, Element.prototype.classList, and URL -->
  <!-- Uncomment below if legacy browser support is required -->
  <!--
  <script src="https://polyfill.io/v3/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>
  -->

  <!-- Bootstrap CSS and JS (with Popper.js for popovers and tooltips) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
    integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
    integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
    crossorigin="anonymous"></script>

  <!-- json-formatter-js -->
  <script src="https://cdn.jsdelivr.net/npm/json-formatter-js@2.3.4/dist/json-formatter.umd.min.js"></script>

  <!-- datatables -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.css" />
  <script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    .map {
      width: 100%;
      height: 100vh;
      min-width: 400px;
      min-height: 300px;
      box-sizing: border-box;
      cursor: crosshair;
    }

    /* Mouse tooltip */
    .mouse-tooltip {
      position: absolute;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      padding: 2px 5px;
      border-radius: 3px;
      font-size: 15px;
      font-weight: 500;
      pointer-events: none;
      z-index: 10000;
      display: none;
      transform: translate(-50%, 100%);
      margin-top: 2px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .mouse-tooltip::before {
      content: '';
      position: absolute;
      top: -3px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 3px solid transparent;
      border-right: 3px solid transparent;
      border-bottom: 3px solid rgba(255, 255, 255, 0.95);
    }

    /* Spin animation for refresh indicator */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    body {
      /* transform: scale(0.8);
      transform-origin: 0 0;
      width: 125%; */
      margin: 0;
      padding: 0;
      overflow: hidden;
    }

    .container-fluid {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    .row {
      margin: 0;
      height: 100vh;
      overflow: hidden;
    }

    .scrollable-column {
      height: 100vh;
      overflow-y: auto;
      width: 385px;
      min-width: 385px;
      max-width: 385px;
      flex: 0 0 385px;
      box-sizing: border-box;
      padding: 0;
    }

    /* Fixed left panel layout */
    .col-md-3 {
      flex: 0 0 385px !important;
      max-width: 385px !important;
      min-width: 385px !important;
      padding: 0 !important;
      margin: 0 !important;
    }

    .col-md-9 {
      flex: 1 !important;
      max-width: calc(100vw - 385px) !important;
      width: calc(100vw - 385px) !important;
      padding: 0 !important;
      margin: 0 !important;
      height: 100vh;
      overflow: hidden;
    }

    /* Remove Bootstrap default margins and paddings */
    .container-fluid {
      padding-left: 0 !important;
      padding-right: 0 !important;
    }

    .row {
      margin-left: 0 !important;
      margin-right: 0 !important;
    }

    .col-md-3,
    .col-md-9 {
      padding-left: 0 !important;
      padding-right: 0 !important;
    }

    /* Ensure no overflow on body and html */
    html {
      overflow: hidden;
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      height: 100%;
    }


    table {
      border-collapse: separate;
      border-spacing: 0 2px;
    }

    table td {
      width: 160px;
    }

    .form-group {
      min-width: 200px;
    }

    .input-group-text {
      min-width: 120px;
      max-width: 120px;
      width: 120px;
      height: 38.5px;
      text-align: left;
      justify-content: flex-start;
      display: flex;
      align-items: center;
      padding-left: 12px;
    }

    .form-control {
      height: 38.5px;
    }

    .card {
      font-size: 1.1rem;
    }

    /* dropdown button style */
    .dropdown-menu {
      width: 98%;
      font-size: 1.0rem;
    }

    .dropdown-menu a {
      border-bottom: 1px solid #b4b4b4;
      padding: 12px 15px;
    }

    .dropdown-menu a:hover {
      background-color: #98ed90;
    }

    /* JSONFormatter value string wrapping */
    #jsonoutput .json-formatter-string {
      word-wrap: break-word !important;
      overflow-wrap: break-word !important;
      white-space: pre-wrap !important;
      word-break: break-all !important;
      max-width: 100% !important;
    }

    #jsonoutput .json-formatter-row .json-formatter-string {
      word-wrap: break-word !important;
      overflow-wrap: break-word !important;
      white-space: pre-wrap !important;
      word-break: break-all !important;
    }

    /* Remove quotes from string values in JSONFormatter */
    #jsonoutput .json-formatter-string:before,
    #jsonoutput .json-formatter-string:after {
      content: "" !important;
    }

    #jsonoutput .json-formatter-string {
      quotes: none !important;
    }

    /* View Selection Buttons Styling */
    .view-selection-container {
      display: flex;
      width: 100%;
      margin-bottom: 8px;
      border-radius: 0.375rem;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .view-selection-container .btn {
      flex: 1;
      font-weight: 500;
      font-size: 0.875rem;
      padding: 0.25rem 0.25rem;
      transition: all 0.2s ease;
      outline: none !important;
      box-shadow: none !important;
    }
    
    .view-selection-container .btn:focus {
      outline: none !important;
      box-shadow: none !important;
    }
    
    .view-selection-container .btn:not(:last-child) {
      border-top-right-radius: 0;
      border-bottom-right-radius: 0;
      border-right: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .view-selection-container .btn:not(:first-child) {
      border-top-left-radius: 0;
      border-bottom-left-radius: 0;
    }
    
    .view-selection-container .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    /* Ensure nav tabs have consistent spacing */
    .nav-tabs {
      margin-bottom: 0;
    }
    
    .nav-tabs .nav-item {
      flex: 1;
    }
    
    .nav-tabs .nav-link {
      font-size: 0.875rem;
      font-weight: 500;
      padding: 0.5rem 0.75rem;
      text-align: center;
      width: 100%;
    }

    /* Context menu styles for SweetAlert */
    .swal2-mci-context {
      font-family: inherit !important;
    }

    .swal2-mci-context .btn-context {
      width: 100% !important;
      padding: 10px 8px !important;
      font-size: 1.1rem !important;
      font-weight: 500 !important;
      border-radius: 6px !important;
      margin: 0 !important;
      transition: all 0.2s ease !important;
    }

    .swal2-mci-context .btn-context:hover {
      transform: translateY(-1px) !important;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    }

    .swal2-mci-context .btn-context:focus {
      outline: none !important;
      box-shadow: none !important;
    }

    .swal2-mci-context .btn-success {
      background-color: #28a745 !important;
      border-color: #28a745 !important;
    }

    .swal2-mci-context .btn-info {
      background-color: #17a2b8 !important;
      border-color: #17a2b8 !important;
    }

    .swal2-mci-context .btn-warning {
      background-color: #ffc107 !important;
      border-color: #ffc107 !important;
      color: #212529 !important;
    }

    .swal2-mci-context .btn-primary {
      background-color: #007bff !important;
      border-color: #007bff !important;
    }

    .swal2-mci-context .btn-danger {
      background-color: #dc3545 !important;
      border-color: #dc3545 !important;
    }

    .swal2-mci-context .btn-secondary {
      background-color: #6c757d !important;
      border-color: #6c757d !important;
    }

    /* Ensure consistent icon spacing and prevent layout shift */
    .fas, .far, .fal, .fab {
      display: inline-block;
      width: 1em;
      text-align: center;
    }

    /* Prevent layout shift during icon loading */
    #mapConnectionStatus i {
      min-width: 12px;
      display: inline-block;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <!-- <h3 class="my-1">CB-Tumblebug Map Dashboard</h3> -->

    <div class="row">
      <!-- Left Column for Tabs -->
      <div class="col-md-3 scrollable-column">

        <!-- View Selection Buttons -->
        <div class="view-selection-container" role="group" aria-label="View Selection">
          <button type="button" id="mapToggle" class="btn btn-link text-muted" onclick="showMap()">
            🗺️ Map
          </button>
          <button type="button" id="dashboardToggle" class="btn btn-link text-muted" onclick="showDashboard()">
            📊 Dashboard
          </button>
          <button type="button" id="apiToggle" class="btn btn-link text-muted" onclick="showSwagger()">
            🛠️ API
          </button>
        </div>

        <!-- Tab Navigation -->
        <ul class="nav nav-tabs nav-fill" id="mainTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <a class="nav-link active" id="provision-tab" data-toggle="tab" href="#provision" role="tab"
              aria-controls="provision" aria-selected="true">🚀 Provision</a>
          </li>
          <li class="nav-item" role="presentation">
            <a class="nav-link" id="control-tab" data-toggle="tab" href="#control" role="tab" aria-controls="control"
              aria-selected="false">🕹️ Control</a>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="mainTabContent">
          <!-- Provisioning Tab -->
          <div class="tab-pane fade show active" id="provision" role="tabpanel" aria-labelledby="provision-tab">
            <div class="card mb-2">
              <div class="card-header">🚀 MC-Infra Recommendation</div>
              <div class="card-body d-flex flex-column">
                <form id="mci-configuration-form">

                  <!-- Namespace ID Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🏷️ NS ID</span>
                      </div>
                      <select id="namespace" name="namespace" class="form-control" aria-label="Namespace ID"
                        aria-describedby="namespaceLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>


                  <!-- Recommendation Policy Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🎯 Policy</span>
                      </div>
                      <select id="recommendPolicy" name="recommendPolicy" class="form-control">
                        <option value="location" selected="selected">Location-based</option>
                        <option value="price">Cost-based</option>
                        <option value="performance">Performance-based</option>
                        <option value="random">Random-based</option>
                      </select>
                    </div>
                  </div>

                  <!-- Provider Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">☁️ Provider</span>
                      </div>
                      <div class="dropdown" style="flex: 1;">
                        <button class="form-control dropdown-toggle text-left" 
                                type="button" id="provider-dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <span id="provider-selection-text">ALL</span>
                        </button>
                        <div class="dropdown-menu w-100" aria-labelledby="provider-dropdown" style="max-height: 400px; overflow-y: auto;">
                          <div class="dropdown-item-text">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="provider-all" value="" checked>
                              <label class="form-check-label" for="provider-all">ALL</label>
                            </div>
                          </div>
                          <div class="dropdown-divider"></div>
                          <div id="provider-checkboxes">
                            <!-- Provider checkboxes will be dynamically populated -->
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>


                  <!-- CPU Range Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🖥️ vCPU</span>
                      </div>
                      <input type="number" class="form-control m-0" id='minVCPU' value="1" min="1" max="999447"
                        step="1">
                      <span class="mx-1">~</span>
                      <input type="number" class="form-control m-0" id='maxVCPU' value="" min="1" max="999448" step="1">
                    </div>
                  </div>


                  <!-- Memory Range Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">💾 Mem(Gi)</span>
                      </div>
                      <input type="number" class="form-control m-0" id='minRAM' value="0.5" min="0.5" max="99912288"
                        step="0.5">
                      <span class="mx-1">~</span>
                      <input type="number" class="form-control m-0" id='maxRAM' value="" min="0.5" max="99912289"
                        step="0.5">
                    </div>
                  </div>

                  <!-- Spec Name Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🏷️ SpecID</span>
                      </div>
                      <input type="text" class="form-control" id="specName" name="specName" value=""
                        placeholder="Ex: 2xlarge">
                    </div>
                  </div>

                  <!-- Spec Architecture Type Field -->
                  <!-- "osArchitecture": [
                    "arm64",
                    "arm64_mac",
                    "na",
                    "s390x",
                    "x86_32",
                    "x86_64",
                    "x86_64_mac"
                  ], -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🏗️ SpecArch</span>
                      </div>
                      <select id="architecture" name="architecture" class="form-control">
                        <option value="">Any</option>
                        <option value="x86_64" selected="selected">x86_64</option>
                        <option value="x86_64_mac">x86_64_mac</option>
                        <option value="x86_32">x86_32</option>
                        <option value="arm64">arm64</option>
                        <option value="arm64_mac">arm64_mac</option>
                        <option value="s390x">s390x</option>
                        <option value="na">Undefined</option>
                      </select>
                    </div>
                  </div>

                  <!-- OS Image Type Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">💽 Image</span>
                      </div>
                      <select id="osImage" name="osImage" class="form-control">
                        <option value="">Any</option>
                        <option value="Ubuntu 20.04">Ubuntu 20.04</option>
                        <option value="Ubuntu 22.04" selected="selected">Ubuntu 22.04</option>
                        <option value="Ubuntu 24.04">Ubuntu 24.04</option>
                        <option value="Debian 10">Debian 10</option>
                        <option value="Debian 11">Debian 11</option>
                        <option value="Debian 12">Debian 12</option>
                        <option value="Windows 2022">Windows 2022</option>
                      </select>
                    </div>
                  </div>

                  <!-- Disk Size Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">💿 Disk(GB)</span>
                      </div>
                      <input type="text" class="form-control" id="diskSize" name="diskSize" placeholder="Ex: 250">
                    </div>
                  </div>

                  <!-- Workload Type Toggle -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">⚙️ Workload</span>
                      </div>
                      <div class="btn-group btn-group-toggle w-100" data-toggle="buttons" style="flex: 1;">
                        <label class="btn btn-outline-success active" style="flex: 1;">
                          <input type="radio" name="workloadType" id="vmMode" value="vm" checked onchange="toggleWorkloadType()"> 
                          <i class="fas fa-server"></i> VM
                        </label>
                        <label class="btn btn-outline-success" style="flex: 1;">
                          <input type="radio" name="workloadType" id="k8sMode" value="k8s" onchange="toggleWorkloadType()"> 
                          <i class="fas fa-dharmachakra"></i> K8s
                        </label>
                      </div>
                    </div>
                  </div>

                  <!-- Accelerator Configuration Field -->
                  <div class="form-group">
                    <div id="headingAccelerator">
                      <button class="btn btn-outline-primary w-100" type="button" data-toggle="collapse"
                        data-target="#collapseAccelerator" aria-expanded="false" aria-controls="collapseAccelerator">
                        🧮 GPU Config
                    </div>
                    <div id="collapseAccelerator" class="collapse" aria-labelledby="headingAccelerator"
                      data-parent="#mci-configuration-form">
                      <div class="px-0 py-0">

                        <!-- Accelerator Model Field -->
                        <div class="form-group">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">🔧 Model</span>
                            </div>
                            <select class="form-control" id="acceleratorModel" name="acceleratorModel">
                              <option value="" selected="selected">-- Select GPU Model --</option>
                              <optgroup label="General Options">
                                <option value="any">Any GPU - All Models</option>
                                <option value="NVIDIA">NVIDIA - Any Model</option>
                                <option value="AMD">AMD - Any Model</option>
                              </optgroup>
                              <optgroup label="NVIDIA Data Center (Hopper)">
                                <option value="H100">H100 - HPC & AI Training</option>
                                <option value="H200">H200 - Enhanced Hopper</option>
                              </optgroup>
                              <optgroup label="NVIDIA Data Center (Ampere)">
                                <option value="A100">A100 - Enterprise AI</option>
                                <option value="A800">A800 - China Compliant</option>
                                <option value="A30">A30 - Mainstream AI</option>
                                <option value="A10">A10 - Multi-Workload</option>
                              </optgroup>
                              <optgroup label="NVIDIA RTX & Professional">
                                <option value="A10G">A10G - Cloud Graphics</option>
                                <option value="L40S">L40S - Omniverse & AI</option>
                                <option value="L40">L40 - Visual Computing</option>
                                <option value="L4">L4 - AI Video Inference</option>
                                <option value="L20">L20 - Entry AI Inference</option>
                              </optgroup>
                              <optgroup label="NVIDIA Tesla (Legacy)">
                                <option value="V100">V100 - Volta Architecture</option>
                                <option value="T4">T4 - Turing Inference</option>
                                <option value="P100">P100 - Pascal HPC</option>
                                <option value="P4">P4 - Pascal Inference</option>
                              </optgroup>
                              <optgroup label="AMD Instinct (CDNA)">
                                <option value="MI300X">MI300X - Latest CDNA3</option>
                                <option value="MI250X">MI250X - CDNA2 Flagship</option>
                                <option value="MI210">MI210 - CDNA2 Mainstream</option>
                                <option value="MI100">MI100 - First CDNA</option>
                                <option value="MI50">MI50 - Vega 20 Based</option>
                                <option value="MI25">MI25 - Fiji Based</option>
                              </optgroup>
                              <optgroup label="AMD Radeon Pro (Virtualization)">
                                <option value="V620">V620 - Data Center GPU</option>
                                <option value="V520">V520 - Entry Virtual GPU</option>
                                <option value="V710">V710 - High-End Virtual</option>
                              </optgroup>
                              <optgroup label="Intel & Alternative">
                                <option value="INTEL">Intel - Xe & Arc</option>
                                <option value="XILINX">Xilinx - FPGA Accelerator</option>
                              </optgroup>
                            </select>
                          </div>
                        </div>

                        <!-- Accelerator Count Range Field -->
                        <div class="form-group">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">🧮 Count</span>
                            </div>
                            <input type="number" class="form-control" id='minAcceleratorCount' min="1" max="999998"
                              step="1">
                            <span class="mx-1">~</span>
                            <input type="number" class="form-control" id='maxAcceleratorCount' min="1" max="999999"
                              step="1">
                          </div>
                        </div>

                        <!-- Accelerator Memory Range Field -->
                        <div class="form-group">
                          <div class="input-group">
                            <div class="input-group-prepend">
                              <span class="input-group-text">🧠 Mem(GB)</span>
                            </div>
                            <input type="number" class="form-control" id='minAMEM' min="1" max="999998" step="1">
                            <span class="mx-1">~</span>
                            <input type="number" class="form-control" id='maxAMEM' min="1" max="999999" step="1">
                          </div>
                        </div>

                      </div>
                    </div>
                  </div>


                </form>
              </div>
            </div>

            <!-- MC-Infra Configuration Review Card -->
            <div class="card mb-2" id="mci-review-card" style="display: none;">
              <div class="card-header">📋 MC-Infra Configuration</div>
              <div class="card-body">
                <div id="subgroup-list" class="list-group">
                  <!-- Dynamic SubGroup items will be added here -->
                </div>
                <div class="text-center mt-2" id="no-subgroups" style="color: #6c757d; font-style: italic;">
                  No SubGroups configured yet. Click on the map to add locations.
                </div>
              </div>
            </div>

          </div>

          <!-- Control Tab -->
          <div class="tab-pane fade" id="control" role="tabpanel" aria-labelledby="control-tab">
            <div class="card mb-2">
              <div class="card-header">🕹️ MC-Infra Control</div>
              <div class="card-body d-flex flex-column">
                <form id="mci-control-form">

                  <!-- X-Request-Id list -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">📝 Req Log</span>
                      </div>
                      <select id="xRequestIdSelect" name="xRequestId" class="form-control" aria-label="X-Request-Id"
                        aria-describedby="xRequestIdLabel" onchange="handleRequestIdSelection();">
                        <option value="">Select ID</option>
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>

                  <!-- Namespace ID Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🏷️ NS ID</span>
                      </div>
                      <select id="namespace-control" name="namespace" class="form-control" aria-label="Namespace ID"
                        aria-describedby="namespaceLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>


                  <!-- MCI ID Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🏗️ MCI ID</span>
                      </div>
                      <select id="mciid" name="mciid" class="form-control" aria-label="MCI ID"
                        aria-describedby="mciidLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>

                  <!-- VM ID Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🖥️ VM ID</span>
                      </div>
                      <select id="vmid" name="vmid" class="form-control" aria-label="VM ID"
                        aria-describedby="vmidLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>

                  <!-- VM Public IP Field -->
                  <div class="form-group">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🌐 Pub IP</span>
                      </div>
                      <select id="pubip" name="pubip" class="form-control" aria-label="Pub IP"
                        aria-describedby="pubipLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>

                  <!-- Control Actions Button (success) -->
                  <div class="form-group">
                    <button type="button" id="controlActionsBtn" onClick="showActionsMenu();"
                      class="btn btn-success w-100">🕹️ Control MCI</button>
                  </div>

                  <!-- Status Field (success) -->
                  <div class="form-group">
                    <button type="button" id="statusBtn" onClick="statusMCI();" class="btn btn-success w-100">📊 Get
                      Status</button>
                  </div>

                  <!-- MCI Access Field (success) -->
                  <div class="form-group dropdown">
                    <button class="btn btn-success dropdown-toggle w-100" type="button" id="accessDropdown"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      🔑 Get Access
                    </button>
                    <div class="dropdown-menu" aria-labelledby="accessDropdown">
                      <a class="dropdown-item" href="javascript:void(0)" onClick="getAccessInfo();">Get Access Info</a>
                      <a class="dropdown-item save-file" href="javascript:void(0)">Save SSH Key</a>
                    </div>
                  </div>

                  <!-- Remote Command Field (Warning) -->
                  <div class="form-group">
                    <button type="button" id="remoteCmd" onClick="executeRemoteCmd();" class="btn btn-warning w-100">
                      💻 Remote Command</button>
                  </div>

                  <!-- File Transfer Field (Warning) -->
                  <div class="form-group">
                    <button type="button" id="filetransfer" onClick="transferFileToMci();"
                      class="btn btn-warning w-100">💾 Remote File Transfer</button>
                  </div>

                  <!-- Snapshot Management Field (Info) -->
                  <div class="form-group">
                    <button type="button" id="snapshotManagement" onClick="showSnapshotManagementModal();"
                      class="btn btn-warning w-100">📸 Snapshot Management</button>
                  </div>

                  <!-- Scale Out SubGroup Field -->
                  <div class="form-group">
                    <button type="button" id="scaleOutBtn" onClick="scaleOutSubGroupWithSelection();"
                      class="btn btn-info w-100">⬆️ ScaleOut SubGroup</button>
                  </div>


                  <!-- Update Firewall Rules Field (Success) -->
                  <div class="form-group">
                    <button type="button" id="updateFirewall" onClick="updateFirewallRules();"
                      class="btn btn btn-info w-100">🔥 Update Firewall</button>
                  </div>

                  <!-- NLB Control Field (Info) -->
                  <div class="form-group">
                    <button type="button" id="nlbControlBtn" onClick="manageNLB();"
                      class="btn btn-info w-100">⚖️ Control L4 NLB</button>
                  </div>

                  <!-- Delete MCI Field (secondary) -->
                  <div class="form-group">
                    <button type="button" id="deleteMciBtn" onClick="executeAction('delete');"
                      class="btn btn-secondary w-100">🛑 Delete MCI</button>
                  </div>

                </form>
              </div>
            </div>

            <div class="card mb-2">
              <div class="card-header">📦 Resource Control</div>
              <div class="card-body d-flex flex-column">
                <form id="resource-view-form" class="form-row">


                  <!-- Release Resources Field -->
                  <div class="form-group col-12">
                    <button type="button" id="delResources" onClick="releaseResources();"
                      class="btn btn-secondary w-100">🛑 Release Resources</button>
                  </div>


                  <!-- Resource Control Field -->
                  <div class="form-group col dropdown">
                    <button class="btn btn-info dropdown-toggle w-100" type="button" id="resourceControlDropdown"
                      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      🔧 Resource Control
                    </button>
                    <div class="dropdown-menu" aria-labelledby="resourceControlDropdown">
                      <a class="dropdown-item" href="javascript:void(0)" onClick="releaseResources();">🗑️ Release
                        Resources</a>
                      <a class="dropdown-item" href="javascript:void(0)" onClick="resourceOverview();">👁️ Overview
                        Resources</a>
                      <a class="dropdown-item" href="javascript:void(0)" onClick="registerCspResource();">📝 Register
                        Existing
                        Resources</a>
                    </div>
                  </div>

                  <!-- Schedule Resource Registration Field -->
                  <div class="form-group col-12">
                    <button type="button" id="scheduleJobsBtn" onClick="showScheduleJobManagement();"
                      class="btn btn-success w-100">📅 Schedule Jobs Management</button>
                  </div>


                  <!-- vNet ID Field -->
                  <div class="form-group col-12">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🌐 VNet</span>
                      </div>
                      <select id="vNet" name="vNet" class="form-control" aria-label="vNet ID"
                        aria-describedby="vNetLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>

                  <!-- securityGroup Field -->
                  <div class="form-group col-12">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🔒 Security</span>
                      </div>
                      <select id="securityGroup" name="securityGroup" class="form-control" aria-label="securityGroup ID"
                        aria-describedby="securityGroupLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>


                  <!-- sshKey Field -->
                  <div class="form-group col-12">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🔑 SSHKey</span>
                      </div>
                      <select id="sshKey" name="sshKey" class="form-control" aria-label="sshKey ID"
                        aria-describedby="sshKeyLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>

                  <!-- image Field -->
                  <!-- <div class="form-group col-12">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="imageLabel">Image</span>
                  </div>
                  <select id="image" name="image" class="form-control" aria-label="image ID"
                    aria-describedby="imageLabel">
                  </select>
                </div>
              </div> -->

                  <!-- spec Field -->
                  <!-- <div class="form-group col-12">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="specLabel">Spec</span>
                  </div>
                  <select id="spec" name="spec" class="form-control" aria-label="spec ID" aria-describedby="specLabel">
                  </select>
                </div>
              </div> -->

                  <!-- connection Field -->
                  <div class="form-group col-12">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text">🔗 Connect</span>
                      </div>
                      <select id="connection" name="connection" class="form-control" aria-label="connection ID"
                        aria-describedby="connectionLabel">
                        <!-- Options will be filled dynamically -->
                      </select>
                    </div>
                  </div>



                </form>
              </div>
            </div>


          </div>

        </div>

      </div>

      <!-- Right Column for Map or API-->
      <div class="col-md-9">
        <div id="map" class="map" style="display:block;">
          <div id="popup"></div>

          <!-- Mouse tooltip -->
          <div id="mouseTooltip" class="mouse-tooltip">➕ ┃ 🗂️</div>

          <!-- Map Controls (top-right floating) - Dashboard style -->
          <div id="map-controls" style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: rgba(255, 255, 255, 0.95); border-radius: 8px; padding: 8px 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border: 1px solid rgba(0,0,0,0.1); backdrop-filter: blur(10px);">
            <div style="display: flex; align-items: center; gap: 12px; font-size: 12px; color: #6c757d; white-space: nowrap;">
              
              <!-- Connection Status -->
              <span id="mapConnectionStatus" class="badge badge-secondary" style="font-size: 10px; min-width: 95px; width: 95px; text-align: center; display: inline-block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                <i class="fas fa-question-circle" style="margin-right: 3px;"></i>Unknown
              </span>
              
              <!-- Last Updated -->
              <span>
                at <span id="mapLastUpdatedTime" style="font-weight: 500;">Never</span>
              </span>
              
              <!-- Refresh Indicator -->
              <i class="fas fa-sync-alt" id="mapRefreshIndicator" style="visibility: hidden; animation: spin 1s linear infinite; width: 12px; text-align: center;"></i>
              
              <!-- Settings Button -->
              <button onclick="showMapSettings()" style="background: none; border: none; color: #495057; padding: 2px 6px; border-radius: 4px; cursor: pointer; font-size: 12px;" onmouseover="this.style.backgroundColor='rgba(0,0,0,0.1)'" onmouseout="this.style.backgroundColor='transparent'">
                <i class="fas fa-cog"></i> Settings
              </button>
              
            </div>
          </div>

          <!-- Spinner for request status -->
          <div id="spinner-container"
            style="display: none; position: absolute; bottom: 10px; left: 20px; z-index: 1000; align-items: center;">
            <div class="spinner-border text-primary spinner-border-sm " role="status">
              <span class="sr-only">Loading...</span>
            </div>
            <div id="spinner-text"
              style="margin-left: 10px; background-color: #00ba06; color: white; padding: 5px 10px; border-radius: 4px;">
              ...
            </div>
          </div>

        </div>

        <!-- Admin dashboards -->
        <div id="console" style="display:none; width:100%; height:100%; position:absolute; top:0; left:0;">
          <!-- Iframes will be dynamically added here -->
        </div>
      </div>

    </div>


    <script type="module" src="./index.js"></script>
    <script type="text/javascript">
      // Cache current host to avoid repeated access
      var currentHost = window.location.hostname;

      // Tab functionality
      $(document).ready(function () {
        // Enable Bootstrap tab functionality
        $('#mainTabs a').on('click', function (e) {
          e.preventDefault()
          $(this).tab('show')
        })
      });

      // Helper function to show/hide iframes
      function switchIframe(activeId, inactiveId, src) {
        document.getElementById('map').style.display = "none";
        
        var console = document.getElementById('console');
        console.style.display = "flex";
        
        // Get or create active iframe
        var activeIframe = document.getElementById(activeId);
        if (!activeIframe) {
          activeIframe = document.createElement('iframe');
          activeIframe.id = activeId;
          activeIframe.src = src;
          activeIframe.style.cssText = 'width:100%; height:100%; border:none; position:absolute; top:0; left:0;';
          console.appendChild(activeIframe);
        }
        activeIframe.style.display = 'block';
        
        // Hide inactive iframe if exists
        var inactiveIframe = document.getElementById(inactiveId);
        if (inactiveIframe) {
          inactiveIframe.style.display = 'none';
        }
      }

      function showSwagger() {
        switchIframe('swagger-iframe', 'dashboard-iframe', `http://${currentHost}:1324/swagger.html`);
        $('#control-tab').tab('show');
        updateToggleButtons('api');
      }

      function showDashboard() {
        switchIframe('dashboard-iframe', 'swagger-iframe', 'dashboard.html');
        $('#control-tab').tab('show');
        updateToggleButtons('dashboard');
      }

      function openSpecInfo(path) {
        var currentHost = window.location.hostname;
        var url = `http://${currentHost}:3000/auto/dashboard/${path}`;
        
        // Try to open the specific dashboard
        var newWindow = window.open(url, '_blank');
        
        // Fallback: if the page doesn't load, redirect to Info Home after a short delay
        setTimeout(() => {
          try {
            if (newWindow.document.readyState === 'complete' && newWindow.document.title.includes('Not found')) {
              newWindow.location.href = `http://${currentHost}:3000`;
            }
          } catch (e) {
            // Cross-origin restrictions may prevent access, so we'll use a simpler fallback approach
            console.log('Opening Spec Info dashboard:', url);
          }
        }, 2000);
      }

      function openImageInfo(path) {
        var currentHost = window.location.hostname;
        var url = `http://${currentHost}:3000/auto/dashboard/${path}`;
        
        // Try to open the specific dashboard
        var newWindow = window.open(url, '_blank');
        
        // Fallback: if the page doesn't load, redirect to Info Home after a short delay
        setTimeout(() => {
          try {
            if (newWindow.document.readyState === 'complete' && newWindow.document.title.includes('Not found')) {
              newWindow.location.href = `http://${currentHost}:3000`;
            }
          } catch (e) {
            // Cross-origin restrictions may prevent access, so we'll use a simpler fallback approach
            console.log('Opening Image Info dashboard:', url);
          }
        }, 2000);
      }

      function showMetabase() {
        // Legacy function - redirect to Info Home
        var currentHost = window.location.hostname;
        window.open(`http://${currentHost}:3000`, '_blank');
      }

      function showGitHub() {
        // Simply open GitHub in new tab
        window.open('https://github.com/cloud-barista/cb-tumblebug', '_blank');
      }

      function showMap() {
        // Hide all dashboard views and show map
        document.getElementById('console').style.display = "none";
        
        // Show map
        document.getElementById('map').style.display = "block";
        
        // Update toggle buttons
        updateToggleButtons('map');
      }

      // Update toggle button states
      function updateToggleButtons(activeView) {
        const mapToggle = document.getElementById('mapToggle');
        const dashboardToggle = document.getElementById('dashboardToggle');
        const apiToggle = document.getElementById('apiToggle');
        
        // Reset all buttons to link style (minimal appearance)
        mapToggle.className = 'btn btn-link text-muted';
        dashboardToggle.className = 'btn btn-link text-muted';
        apiToggle.className = 'btn btn-link text-muted';
        
        // Set active state
        if (activeView === 'map') {
          mapToggle.className = 'btn btn-link text-dark font-weight-bold';
        } else if (activeView === 'dashboard') {
          dashboardToggle.className = 'btn btn-link text-dark font-weight-bold';
        } else if (activeView === 'api') {
          apiToggle.className = 'btn btn-link text-dark font-weight-bold';
        }
      }

      // Legacy function for backward compatibility
      function toggleView() {
        showSwagger();
      }
    </script>

    <script type="text/javascript">
      window.addEventListener('resize', setLayoutSizes);

      function setLayoutSizes() {
        var windowHeight = window.innerHeight;
        var windowWidth = window.innerWidth;

        // Fixed left panel dimensions
        var leftPanelWidth = 385;

        // Set left panel height (fixed width, responsive height)
        var leftPanel = document.querySelector('.scrollable-column');
        if (leftPanel) {
          leftPanel.style.height = windowHeight + 'px';
          leftPanel.style.width = leftPanelWidth + 'px';
        }

        // Set left column fixed width
        var leftColumn = document.querySelector('.col-md-3');
        if (leftColumn) {
          leftColumn.style.width = leftPanelWidth + 'px';
          leftColumn.style.minWidth = leftPanelWidth + 'px';
          leftColumn.style.maxWidth = leftPanelWidth + 'px';
          leftColumn.style.height = windowHeight + 'px';
        }

        // Set right column size
        var rightColumn = document.querySelector('.col-md-9');
        if (rightColumn) {
          var rightWidth = windowWidth - leftPanelWidth;
          rightColumn.style.width = rightWidth + 'px';
          rightColumn.style.height = windowHeight + 'px';
        }

        // Set map container size with exact dimensions
        var mapContainer = document.getElementById('map');
        if (mapContainer) {
          // Calculate exact available width for map
          var availableWidth = windowWidth - leftPanelWidth;
          var availableHeight = windowHeight;

          // Ensure minimum dimensions but don't exceed window
          availableWidth = Math.max(400, Math.min(availableWidth, windowWidth - leftPanelWidth));
          availableHeight = Math.max(300, Math.min(availableHeight, windowHeight));

          mapContainer.style.width = availableWidth + 'px';
          mapContainer.style.height = availableHeight + 'px';

          // Trigger map resize if OpenLayers map exists
          if (window.map && window.map.updateSize) {
            setTimeout(() => {
              window.map.updateSize();
            }, 100);
          }
          
          // Invalidate tooltip cache when layout changes
          if (typeof window.invalidateTooltipCache === 'function') {
            window.invalidateTooltipCache();
          }
        }
      }

      // Initial setup
      setLayoutSizes();

      // Legacy function name for compatibility
      function setColumnHeight() {
        setLayoutSizes();
      }
    </script>


    <script type="text/javascript">
      document.addEventListener('DOMContentLoaded', (event) => {
        // Set initial toggle button state (Map is shown by default)
        updateToggleButtons('map');
        
        // event linster for copy to clipboard
        document.querySelectorAll('.input-group-text').forEach(label => {
          label.addEventListener('click', () => {
            // get seleted option
            const select = label.parentElement.nextElementSibling;
            if (select && select.options[select.selectedIndex]) {
              var labelText = label.textContent || label.innerText;
              var selectedOption = select.options[select.selectedIndex];
              
              // Copy the value (not the display text) for all fields
              var toCopy = selectedOption.value;
              
              navigator.clipboard.writeText(toCopy)
                .then(() => {
                  console.log('Text copied to clipboard: ' + toCopy);
                  document.getElementById('message').value = '[' + labelText + ' to Clipboard]\n' + toCopy;
                })
                .catch(err => {
                  console.error('Error in copying text: ', err);
                  document.getElementById('message').value = '[Error in copying to Clipboard]\nLabel: ' + labelText + '\nError: ' + err;
                });
            }
          });
        });
      });

      // Optimized tooltip positioning with smart caching
      const map = document.getElementById('map');
      const tooltip = document.getElementById('mouseTooltip');
      let isMouseDown = false;
      let cachedMapRect = null;
      let cacheInvalidated = true;
      
      // Function to update cache when needed
      function updateMapRectCache() {
        cachedMapRect = map.getBoundingClientRect();
        cacheInvalidated = false;
      }
      
      // Invalidate cache on events that change layout
      window.invalidateTooltipCache = function() {
        cacheInvalidated = true;
      }
      
      // Listen for events that might change map position
      window.addEventListener('resize', window.invalidateTooltipCache);
      window.addEventListener('scroll', window.invalidateTooltipCache);
      
      // Listen for view changes (dashboard/map toggle)
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
            const target = mutation.target;
            if (target.id === 'map' || target.id === 'console') {
              window.invalidateTooltipCache();
            }
          }
        });
      });
      
      // Observe style changes on map and console elements
      observer.observe(document.getElementById('map'), { attributes: true, attributeFilter: ['style'] });
      observer.observe(document.getElementById('console'), { attributes: true, attributeFilter: ['style'] });
      
      map.addEventListener('mouseenter', () => {
        tooltip.style.display = 'block';
        // Update cache when mouse enters map area
        updateMapRectCache();
      });
      
      map.addEventListener('mouseleave', () => { 
        isMouseDown = false; 
        map.style.cursor = 'crosshair'; 
        tooltip.style.display = 'none';
      });
      
      map.addEventListener('mousemove', (e) => {
        // Use cached rect, update only if cache is invalidated
        if (cacheInvalidated) {
          updateMapRectCache();
        }
        
        // Update tooltip position using cached rect
        tooltip.style.left = (e.clientX - cachedMapRect.left) + 'px';
        tooltip.style.top = (e.clientY - cachedMapRect.top) + 'px';
        
        // Update cursor and tooltip visibility if dragging
        if (isMouseDown) {
          map.style.cursor = 'grabbing';
          tooltip.style.display = 'none';
        }
      });
      
      map.addEventListener('mousedown', () => { 
        isMouseDown = true; 
        map.style.cursor = 'none'; 
        tooltip.style.display = 'none';
      });
      
      map.addEventListener('mouseup', () => { 
        isMouseDown = false; 
        map.style.cursor = 'crosshair'; 
        tooltip.style.display = 'block';
      });
    </script>

    <script type="text/javascript">
      // Provider dropdown event handling
      document.addEventListener('DOMContentLoaded', function() {
        // Prevent dropdown from closing when clicking on checkboxes
        $(document).on('click', '#provider-dropdown + .dropdown-menu', function(e) {
          e.stopPropagation();
        });
        
        // Prevent dropdown from closing when clicking on checkbox labels
        $(document).on('click', '#provider-dropdown + .dropdown-menu .form-check-label', function(e) {
          e.stopPropagation();
          // Trigger click on the associated checkbox
          const forId = this.getAttribute('for');
          if (forId) {
            const checkbox = document.getElementById(forId);
            if (checkbox) {
              checkbox.click();
            }
          }
        });
      });
    </script>

</body>

</html>